var gameLogic;!function(a){function b(a,b){return angular.equals(a,b)}function c(a){return angular.copy(a)}function d(){var a,b,c=new Array;for(a=0;10>a;a+=1)for(c[a]=new Array,b=0;10>b;b+=1)c[a][b]="";return c[0][3]="A",c[0][6]="A",c[3][0]="A",c[3][9]="A",c[6][0]="B",c[6][9]="B",c[9][3]="B",c[9][6]="B",c}function e(){var a=d();return{turnInfo:{ctr:2,pawn:"A"},pawnDelta:{row:"",col:""},board:a}}function f(a,b,c){var d,e,f={rowFrom:0,rowTo:0,colFrom:0,colTo:0};for(f=0===a&&0===b?{rowFrom:0,rowTo:1,colFrom:0,colTo:1}:0===a&&9===b?{rowFrom:0,rowTo:1,colFrom:8,colTo:9}:9===a&&0===b?{rowFrom:8,rowTo:9,colFrom:0,colTo:1}:9===a&&9===b?{rowFrom:8,rowTo:9,colFrom:8,colTo:9}:0===a&&b>0&&9>b?{rowFrom:0,rowTo:1,colFrom:b-1,colTo:b+1}:a>0&&9>a&&0===b?{rowFrom:a-1,rowTo:a+1,colFrom:0,colTo:1}:9===a&&b>0&&9>b?{rowFrom:8,rowTo:9,colFrom:b-1,colTo:b+1}:a>0&&9>a&&9===b?{rowFrom:a-1,rowTo:a+1,colFrom:8,colTo:9}:{rowFrom:a-1,rowTo:a+1,colFrom:b-1,colTo:b+1},d=f.rowFrom;d<=f.rowTo;d+=1)for(e=f.colFrom;e<=f.colTo;e+=1)if(""===c[d][e])return 1;return 0}function g(a,b){var c,d,e=0,g=0;for(c=0;10>c;c+=1)for(d=0;10>d;d+=1)"A"===a[c][d]?e+=f(c,d,a):"B"===a[c][d]&&(g+=f(c,d,a));return"A"===b&&0===g?"A":"B"===b&&0===e?"B":""}function h(a,b,d,f){if("{}"===f)f=e();else{var h=angular.fromJson(f);f=h}var i,j,k=f.board,l=f.turnInfo,m=d,n=l,o=a,p=b,q=c(k);if(""!==k[b.row][b.col])throw new Error("pawn must land in empty position");if(2===l.ctr){if(k[a.row][a.col]!==l.pawn)throw new Error("pawn has to exist at position");q[a.row][a.col]=""}if(1===l.ctr){if(a.row!==f.pawnDelta.row||a.col!==f.pawnDelta.col)throw new Error("Wrong position for shooting arrow");if(0===d&&"A"!==k[a.row][a.col]||1===d&&"B"!==k[a.row][a.col])throw new Error("player has to shoot arrow from the same place")}if(q[b.row][b.col]=l.pawn,1===l.ctr){if(i=g(q,q[a.row][a.col]),""!==i){j={endMatch:{endMatchScores:"A"===i?[1,0]:"B"===i?[0,1]:[0,0]}},n={ctr:"",pawn:""};var r="A"===i?"Game Over! White player wins":"Game over! Black Player wins";return window.alert(r),[j,{set:{key:"turnInfo",value:n}},{set:{key:"pawnPosition",value:{row:o.row,col:o.col}}},{set:{key:"pawnDelta",value:{row:p.row,col:p.col}}},{set:{key:"board",value:q}}]}0===d?(m=1,n.ctr=2,n.pawn="B"):1===d&&(m=0,n.ctr=2,n.pawn="A")}else n.ctr=1,n.pawn="X";return j={setTurn:{turnIndex:m}},[j,{set:{key:"turnInfo",value:n}},{set:{key:"pawnPosition",value:{row:o.row,col:o.col}}},{set:{key:"pawnDelta",value:{row:p.row,col:p.col}}},{set:{key:"board",value:q}}]}function i(a,b,c){var d,e,f;if(0!==Math.abs(a.row-b.row))return!1;if(b.col>a.col){for(e=b,f=a,d=f.col+1;d<=e.col;d+=1)if(""!==c[e.row][d])return!1}else for(e=a,f=b,d=e.col-1;d>=f.col;d-=1)if(""!==c[e.row][d])return!1;return!0}function j(a,b,c){var d,e,f;if(0!==Math.abs(a.col-b.col))return!1;if(b.row>a.row){for(d=b,e=a,f=e.row+1;f<=d.row;f+=1)if(""!==c[f][d.col])return!1}else for(d=a,e=b,f=d.row-1;f>=e.row;f-=1)if(""!==c[f][d.col])return!1;return!0}function k(a,b,c){var d,e,f,g;if(Math.abs(a.row-b.row)!==Math.abs(a.col-b.col))return!1;if(d=b,e=a,b.col>a.col&&b.row<a.row)for(f=e.row-1,g=e.col+1;f>=d.row&&g<=d.col;){if(""!==c[f][g])return!1;f-=1,g+=1}else if(b.col>a.col&&b.row>a.row)for(f=e.row+1,g=e.col+1;f<=d.row&&g<=d.col;){if(""!==c[f][g])return!1;f+=1,g+=1}else if(b.col<a.col&&b.row>a.row)for(f=e.row+1,g=e.col-1;f<=d.row&&g>=d.col;){if(""!==c[f][g])return!1;f+=1,g-=1}else if(b.col<a.col&&b.row<a.row)for(f=e.row-1,g=e.col-1;f>=d.row&&g>=d.col;){if(""!==c[f][g])return!1;f-=1,g-=1}return!0}function l(){var a=[{turnIndexBeforeMove:{turnIndex:0},stateBeforeMove:{turnInfo:{ctr:2,pawn:"A"},pawnDelta:{row:"",col:""},board:[["","","","A","","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["","","","B","","","B","","",""]]},move:[{setTurn:{turnIndex:0}},{set:{key:"turnInfo",value:{ctr:1,pawn:"X"}}},{set:{key:"pawnPosition",value:{row:0,col:3}}},{set:{key:"pawnDelta",value:{row:0,col:4}}},{set:{key:"board",value:[["","","","","A","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["","","","B","","","B","","",""]]}}],comment:"player 0 starts and moves his pawn from (0,3) to (0,4)"},{turnIndexBeforeMove:{turnIndex:0},stateBeforeMove:{turnInfo:{ctr:1,pawn:"X"},pawnDelta:{row:0,col:4},board:[["","","","","A","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["","","","B","","","B","","",""]]},move:[{setTurn:{turnIndex:1}},{set:{key:"turnInfo",value:{ctr:2,pawn:"B"}}},{set:{key:"pawnPosition",value:{row:0,col:4}}},{set:{key:"pawnDelta",value:{row:9,col:4}}},{set:{key:"board",value:[["","","","","A","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["","","","B","X","","B","","",""]]}}],comment:"player 0 shoots arrow from (0,4) to (9,4)"},{turnIndexBeforeMove:{turnIndex:1},stateBeforeMove:{turnInfo:{ctr:2,pawn:"B"},pawnDelta:{row:9,col:4},board:[["","","","","A","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["","","","B","X","","B","","",""]]},move:[{setTurn:{turnIndex:1}},{set:{key:"turnInfo",value:{ctr:1,pawn:"X"}}},{set:{key:"pawnPosition",value:{row:6,col:0}}},{set:{key:"pawnDelta",value:{row:9,col:0}}},{set:{key:"board",value:[["","","","","A","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","B","X","","B","","",""]]}}],comment:"player 1 now has the turn and moves his pawn from (6,0) to (9,0)"},{turnIndexBeforeMove:{turnIndex:1},stateBeforeMove:{turnInfo:{ctr:1,pawn:"X"},pawnDelta:{row:9,col:0},board:[["","","","","A","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","B","X","","B","","",""]]},move:[{setTurn:{turnIndex:0}},{set:{key:"turnInfo",value:{ctr:2,pawn:"A"}}},{set:{key:"pawnPosition",value:{row:9,col:0}}},{set:{key:"pawnDelta",value:{row:4,col:0}}},{set:{key:"board",value:[["","","","","A","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["X","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","B","X","","B","","",""]]}}],comment:"player 1 shoots arrow from (9,0) to (4,0)"},{turnIndexBeforeMove:{turnIndex:0},stateBeforeMove:{turnInfo:{ctr:2,pawn:"A"},pawnDelta:{row:4,col:0},board:[["","","","","A","","A","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["X","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","B","X","","B","","",""]]},move:[{setTurn:{turnIndex:0}},{set:{key:"turnInfo",value:{ctr:1,pawn:"X"}}},{set:{key:"pawnPosition",value:{row:0,col:6}}},{set:{key:"pawnDelta",value:{row:0,col:9}}},{set:{key:"board",value:[["","","","","A","","","","","A"],["","","","","","","","","",""],["","","","","","","","","",""],["A","","","","","","","","","A"],["X","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","","B"],["","","","","","","","","",""],["","","","","","","","","",""],["B","","","B","X","","B","","",""]]}}],comment:"player 0 moves his pawn from (0,6) to (0,9)"}];return a}function m(){var a=[{turnIndexBeforeMove:{turnIndex:1},stateBeforeMove:{turnInfo:{ctr:2,pawn:"B"},pawnDelta:{row:"0",col:"2"},board:[["","","X","A","X","X","A","X","",""],["","","X","X","","X","X","X","",""],["X","X","","","","","","","X","X"],["A","X","","","","","","","X","A"],["X","X","","","","X","","X","X","X"],["X","X","","","","","","","X","X"],["B","X","","","","","","","X","B"],["X","X","","","","","","","X","X"],["","","X","X","","","","","",""],["","","X","B","X","X","B","","",""]]},move:[{setTurn:{turnIndex:1}},{set:{key:"turnInfo",value:{ctr:1,pawn:"X"}}},{set:{key:"pawnPosition",value:{row:9,col:3}}},{set:{key:"pawnDelta",value:{row:8,col:4}}},{set:{key:"board",value:[["","","X","A","X","X","A","X","",""],["","","X","X","","X","X","X","",""],["X","X","","","","","","","X","X"],["A","X","","","","","","","X","A"],["X","X","","","","X","","X","X","X"],["X","X","","","","","","","X","X"],["B","X","","","","","","","X","B"],["X","X","","","","","","","X","X"],["","","X","X","B","","","","",""],["","","X","","X","X","B","","",""]]}}],comment:"if B plays a combination of pawn move from 9,3 to 8,4 and then arrow move from 8,4 to 1,4 : B wins"},{turnIndexBeforeMove:{turnIndex:0},stateBeforeMove:{turnInfo:{ctr:2,pawn:"A"},pawnDelta:{row:"9",col:"3"},board:[["X","","X","","X","X","A","X","",""],["","","X","X","","X","X","X","",""],["X","X","","","X","","X","","X","X"],["A","","","X","A","","","","X","A"],["X","X","","","","X","","X","X","X"],["X","","","","X","","","","X","X"],["B","X","","","","","B","","X",""],["X","X","","","","","","","X","X"],["","","X","X","","","","","",""],["X","","X","B","X","X","B","","",""]]},move:[{setTurn:{turnIndex:0}},{set:{key:"turnInfo",value:{ctr:1,pawn:"X"}}},{set:{key:"pawnPosition",value:{row:3,col:4}}},{set:{key:"pawnDelta",value:{row:5,col:2}}},{set:{key:"board",value:[["X","","X","","X","X","A","X","",""],["","","X","X","","X","X","X","",""],["X","X","","","X","","X","","X","X"],["A","","","X","","","","","X","A"],["X","X","","","","X","","X","X","X"],["X","","A","","X","","","","X","X"],["B","X","","","","","B","","X",""],["X","X","","","","","","","X","X"],["","","X","X","","","","","",""],["X","","X","B","X","X","B","","",""]]}}],comment:"A moves to 5,2 and can block off pawn B at 6,0 completely by playing his arrow to 5,1"}];return a}function n(a,b){var c=angular.fromJson(a);a=c;for(var d=[],e=new Array,f=1;4>=f;f++)e[f]=[];var g,i,j,k,l=1,m=a.board,n=a.turnInfo;if(2===n.ctr){for(j=0;10>j;j+=1)for(k=0;10>k;k+=1)if(0===b&&"A"===m[j][k]||1===b&&"B"===m[j][k]){var o={row:j,col:k};d.push(o)}}else d.push(a.pawnDelta);for(console.log(d),j=0;j<d.length;j+=1){var p=d[j];for(k=p.col+1;10>k&&""===m[p.row][k];k+=1)c={row:p.row,col:k},e[l].push(c);for(k=p.col-1;k>=0&&""===m[p.row][k];k-=1)c={row:p.row,col:k},e[l].push(c);for(k=p.row+1;10>k&&""===m[k][p.col];k+=1)c={row:k,col:p.col},e[l].push(c);for(k=p.row-1;k>=0&&""===m[k][p.col];k-=1)c={row:k,col:p.col},e[l].push(c);for(var q=p.row+1,r=p.col+1;10>q&&10>r&&""===m[q][r];)c={row:q,col:r},e[l].push(c),q+=1,r+=1;for(q=p.row+1,r=p.col-1;10>q&&r>=0&&""===m[q][r];)c={row:q,col:r},e[l].push(c),q+=1,r-=1;for(q=p.row-1,r=p.col+1;q>=0&&10>r&&""===m[q][r];)c={row:q,col:r},e[l].push(c),q-=1,r+=1;for(q=p.row-1,r=p.col-1;q>=0&&r>=0&&""===m[q][r];)c={row:q,col:r},e[l].push(c),q-=1,r-=1;l+=1}for(var s,t,u,v;;)if(s=2===n.ctr?Math.floor(4*Math.random()+1):1,g=d[s-1],t=e[s].length,0!==t)break;u=Math.floor(Math.random()*t),v=e[s],i=v[u],console.log(g,i);var w=h(g,i,b,a);return w}function o(a){var c,d=a.move,f=a.turnIndexBeforeMove,g=a.stateBeforeMove,l=g.board;f=0===f?0:1,void 0===l&&(g=e(),l=g.board);var m=d[3].set.value,n=d[2].set.value;try{return i(n,m,l)||j(n,m,l)||k(n,m,l)?(c=h(n,m,f,g),b(d,c)?!0:!1):!1}catch(o){return!1}}a.getInitialBoard=d,a.createMove=h,a.horizontalMoveCheck=i,a.verticalMoveCheck=j,a.diagonalMoveCheck=k,a.getExampleGame=l,a.getRiddles=m,a.createComputerMove=n,a.isMoveOk=o}(gameLogic||(gameLogic={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).factory("gameLogic",function(){return{isMoveOk:gameLogic.isMoveOk,createMove:gameLogic.createMove,createComputerMove:gameLogic.createComputerMove,getInitialBoard:gameLogic.getInitialBoard,getExampleGame:gameLogic.getExampleGame,getRiddles:gameLogic.getRiddles,horizontalMoveCheck:gameLogic.horizontalMoveCheck,verticalMoveCheck:gameLogic.verticalMoveCheck,diagonalMoveCheck:gameLogic.diagonalMoveCheck}});var turnIndex,gameArea,animationEnded=!1,isComputerTurn=!1,isYourTurn,state=null,jsonState,pawnDelta={row:-1,col:-1},lastSelected={row:-1,col:-1},NUM=10,draggingStartedRowCol={row:-1,col:-1},draggingPiece=null,nextZIndex=61,typeExpected,msg,rowsNum=NUM,colsNum=NUM,game;!function(a){function b(){$rootScope.$apply(function(){log.info("Animation ended"),animationEnded=!0,isComputerTurn&&k()})}function c(){resizeGameAreaService.setWidthToHeight(1),gameService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:gameLogic.isMoveOk,updateUI:j}),document.addEventListener("animationend",b,!1),document.addEventListener("webkitAnimationEnd",b,!1),document.addEventListener("oanimationend",b,!1),dragAndDropService.addDragListener("gameArea",d)}function d(a,b,c){gameArea=document.getElementById("gameArea");var d=b-gameArea.offsetLeft,i=c-gameArea.offsetTop,j=typeExpected;if(0>d||0>i||d>=gameArea.clientWidth||i>=gameArea.clientHeight){if(!draggingPiece)return;var k=f();e({top:i-k.height/2,left:d-k.width/2},j),"touchend"===a&&"X"===j&&(draggingPiece.style.display="none")}else{var l=Math.floor(NUM*d/gameArea.clientWidth),m=Math.floor(NUM*i/gameArea.clientHeight);if("touchstart"===a&&draggingStartedRowCol.row<0&&draggingStartedRowCol.col<0&&(state.board[m][l]===j&&isYourTurn&&"X"!==j?(draggingStartedRowCol={row:m,col:l},draggingPiece=document.getElementById("piece"+j+"_"+m+"x"+l),draggingPiece.style["z-index"]=++nextZIndex):isYourTurn&&"X"===j&&(draggingStartedRowCol=pawnDelta,draggingPiece=document.getElementById("pieceX_drag"),e(g(m,l),j),draggingPiece.style["z-index"]=++nextZIndex,draggingPiece.style.display="inline")),!draggingPiece)return;if("touchend"===a){var n=draggingStartedRowCol,o={row:m,col:l};h(n,o)}else e(g(m,l),j)}("touchend"===a||"touchcancel"===a||"touchleave"===a)&&(e(g(draggingStartedRowCol.row,draggingStartedRowCol.col),j),j===typeExpected&&"X"===typeExpected&&(draggingPiece.style.display="none"),draggingStartedRowCol={row:-1,col:-1},draggingPiece=null)}function e(a,b){var c;"X"===b?(c=g(0,0),draggingPiece.style.left=a.left-c.left+"px",draggingPiece.style.top=a.top-c.top+"px"):(c=g(draggingStartedRowCol.row,draggingStartedRowCol.col),draggingPiece.style.left=a.left-c.left+"px",draggingPiece.style.top=a.top-c.top+"px")}function f(){return{width:gameArea.clientWidth/NUM,height:gameArea.clientHeight/NUM}}function g(a,b){var c=f();return{top:a*c.height,left:b*c.width}}function h(a,b){$rootScope.$apply(function(){var c="Dragged piece "+a.row+"x"+a.col+" to square "+b.row+"x"+b.col;if(log.info(c),c=c,isYourTurn)try{if(gameLogic.horizontalMoveCheck(a,b,state.board)||gameLogic.verticalMoveCheck(a,b,state.board)||gameLogic.diagonalMoveCheck(a,b,state.board)){{var d=gameLogic.createMove(a,b,turnIndex,jsonState);({row:b.row,col:b.col})}gameService.makeMove(d),isYourTurn=!1,pawnDelta=b,"X"===typeExpected&&(draggingPiece.style.display="none")}}catch(e){log.info(["Illegal Move ",a,b])}})}function i(a){for(var b=[],c=0;a>c;c++)b.push(c);return b}function j(a){jsonState=angular.toJson(a.stateAfterMove,!0),state=a.stateAfterMove,typeExpected=a.move&&a.move[1]&&a.move[1].set&&a.move[1].set.value?a.move[1].set.value.pawn:"A",void 0===state.board&&(state.board=gameLogic.getInitialBoard()),isYourTurn=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove&&null===a.endMatchScores,turnIndex=a.turnIndexAfterMove,isYourTurn&&""===a.playersInfo[a.yourPlayerIndex].playerId&&(isYourTurn=!1,$timeout(k,1e3))}function k(){gameService.makeMove(gameLogic.createComputerMove(jsonState,turnIndex))}function l(a,b,c){return state.board[a][b]===c?!0:!1}function m(a,b){return"A"===state.board[a][b]||"B"===state.board[a][b]||"X"===state.board[a][b]?!1:!0}function n(){return 0===turnIndex?!0:!1}function o(a,b){return a===lastSelected.row&&b===lastSelected.col?!0:!1}function p(){return 1===turnIndex?!0:!1}a.init=c,a.getIntegersTill=i;i(NUM),i(NUM);a.isPawn=l,a.isNotPawn=m,a.isWTurn=n,a.isSelected=o,a.isBTurn=p}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){$rootScope.game=game,translate.setLanguage("en",{AMAZONS_GAME:"Game of the Amazons",RULES_OF_AMAZONS:"Rules of Amazons",RULES_SLIDE0:"Each player has four amazons, and a supply of arrows. White moves first, and the players alternate moves thereafter.",RULES_SLIDE1:"1. Move one amazon one or more empty squares in a straight line (orthogonally or diagonally).",RULES_SLIDE2:"2. The amazon shoots an arrow from its landing square to another square, using another queenlike move.",RULES_SLIDE3:"An arrow and an amazon cannot cross or enter a square where another arrow or an amazon of either color occupies.",RULES_SLIDE4:"When you play, try to block the other player. The last player to be able to make a move wins.",CLOSE:"Start Game"}),game.init()});
//# sourceMappingURL=everything.min.js.map